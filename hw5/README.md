# DataScienceProj1
-------------------------------------------------------------

## ** #homeWork5: 
 ** 1. Task: 
** Implement min 5 regressors, compare the metrics, analyze and select the best regressor for your dataset.

The following dataset was used for the home work5 task: 
    
   * Concrete Compressive Strength Regression *
  https://www.kaggle.com/code/michaelbryantds/concrete-compressive-strength-regression?select=Concrete_Data_Yeh.csv
    
 ### * Solution (for #homeWork5):*
  https://github.com/Scout95/DataScienceProj1/tree/master/hw5/

## Comparative Analysis and Results Interpretation

### Summary of Regressor Performance

## Concrete Compressive Strength Regression

Датасет предназначен для проверки прогноза прочности бетона на сжатие по его составу и возрасту [Concrete_Data_Yeh.csv] (https://www.kaggle.com/code/michaelbryantds/concrete-compressive-strength-regression?select=Concrete_Data_Yeh.csv).

## Анализ выбросов

### Обнаружение и распределение выбросов

Анализ выбросов проводился по методу межквартильного размаха (IQR) для каждого признака. 
 Количество выбросов по каждому признаку:
 cement               0
 slag                 2
 flyash               0
 water                9
 superplasticizer    10
 coarseaggregate      0
 fineaggregate        5
 age                 59
 csMPa                4
 dtype: int64

Наибольшее количество выбросов выявлено в следующих столбцах:

- **age** (59 выбросов) — связано с наличием образцов с очень малым (3 дня) и очень большим (365 дней) возрастом. Это подтвержает статистика по аномальным записям: в консоли выведена статистика по аномалиям, где видно, что среди выбросов по age:
   - Минимальное значение: 3 дня
   - Максимальное значение: 365 дней
   - Среднее значение: 186 дней
   - Стандартное отклонение: 127 дней
   Это подтверждает, что выбросы по age — это либо очень молодые, либо очень "старые" образцы. Причина возникновения: как правило, такие значения появляются, потому что в строительной практике исследуют как "раннюю" прочность (3, 7, 28 дней), так и "долгосрочную" (180, 365 дней), чтобы оценить свойства бетона на разных этапах твердения.

- **superplasticizer** (10), **water** (9), **fineaggregate** (5), **slag** (2).  С чем это может быть связано:
   - superplasticizer (10 выбросов):
   Суперпластификаторы в бетоне применяются в очень разных дозах, иногда для получения сверхпластичных смесей или в экспериментальных рецептурах. Выбросы могут быть связаны с необычно большими или малыми дозировками, которые редко встречаются в стандартных составах.
   - water (9 выбросов):
   Вода затворения может варьироваться в широких пределах. Выбросы могут соответствовать либо очень "жидким" смесям (с высоким водоцементным отношением), либо, наоборот, "жёстким" (очень мало воды).
   - fineaggregate (5 выбросов):
   Мелкий заполнитель (песок) может быть в необычно больших или малых количествах в некоторых рецептах, например, для проверки крайних свойств бетона.
   - slag (2 выброса):
   Шлак как компонент может быть добавлен в очень больших или очень малых количествах в рамках экспериментальных серий.

   Почему могут появляються такие выбросы:
   Это могут быть **экспериментальные задачи**:
   В таких инженерных датасетах часто специально варьируют составы для исследования предельных свойств материала.
   **Технологические особенности**:
   Некоторые значения могут быть связаны с особенностями сырья или условий приготовления смесей.
   **Ошибки измерений**:
   Часть выбросов может появиться из-за ошибок в лабораторных измерениях или записи данных, но в инженерных датасетах чаще всего это именно экспериментальные точки.

- В целевой переменной **csMPa** обнаружено всего 4 выброса, что говорит о том, что экстремальная прочность встречается редко.
- В признаках **cement**, **flyash**, **coarseaggregate** выбросы отсутствуют.

### Статистика по аномальным записям

Статистический анализ аномальных (выбросных) записей показывает, что их средние и стандартные отклонения по признакам, особенно по возрасту и прочности, существенно выше, чем в среднем по датасету. Это подтверждает наличие экстремальных режимов испытаний и составов смесей.

Таким образом, причины выбросов: Экспериментальные и технологические особенности проектирования смесей, исследование крайних режимов, а также возможные лабораторные ошибки.

### Корреляция выбросов с целевой переменной
[ВЛИЯНИЕ ВЫБРОСОВ НА ЦЕЛЕВУЮ ПЕРЕМЕННУЮ]
Корреляция выбросов с целевой переменной:
cement              0.55
slag                0.08
flyash             -0.41
water              -0.16
superplasticizer    0.33
coarseaggregate     0.02
fineaggregate      -0.11
age                -0.05
csMPa               1.00
Name: csMPa, dtype: float64

- Наибольшая положительная корреляция выбросов с целевой переменной наблюдается у **cement** (0.55) и **superplasticizer** (0.33). Экстремальные значения этих компонентов чаще связаны с высокими/низкими значениями прочности.
- Отрицательная корреляция у **flyash** (-0.41) и **water** (-0.16).
Экстремальные значения этих признаков чаще встречаются при пониженной прочности.
- Корреляция выбросов по признаку **age** с прочностью практически отсутствует (-0.05), что говорит о том, что экстремальные значения возраста не всегда приводят к экстремальной прочности.

### Влияние выбросов на целевую переменную

- Выбросы по ключевым компонентам смеси (cement, superplasticizer) могут существенно влиять на прочность бетона.
- Экстремальные значения возраста не всегда приводят к экстремальной прочности.
- Отрицательная корреляция выбросов flyash и water с прочностью указывает, что необычно высокое или низкое содержание этих компонентов связано с пониженной прочностью.

### Корреляционный анализ признаков
Корреляция superplasticizer с другими признаками.

Основные выводы на основании корреляционной матрицы признаков следующие:

Наиболее сильная отрицательная корреляция между water и superplasticizer (-0.66): это технологически обосновано: увеличение суперпластификатора позволяет уменьшить количество воды при сохранении удобоукладываемости (консистенции) смеси.

Положительная корреляция между superplasticizer и flyash (0.38), csMPa (0.37), fineaggregate (0.22):
Это говорит о том, что увеличение суперпластификатора сопровождается увеличением доли золы и некоторым ростом прочности.

Слабые корреляции между большинством других признаков:
Большинство коэффициентов корреляции по модулю меньше 0.4, что указывает на отсутствие сильных линейных зависимостей между компонентами смеси. Отрицательная с age (-0.19), coarseaggregate (-0.27), slag (0.04 — практически отсутствует).

Некоторые технологические закономерности:
Например, cement и csMPa имеют положительную корреляцию, что ожидаемо, так как увеличение цемента обычно повышает прочность.

Тепловая карта корреляций показала, что большинство признаков имеют слабые линейные связи между собой, за исключением отдельных технологических зависимостей (например, отрицательная корреляция между water и superplasticizer, положительная — между cement и csMPa). Это подтверждает, что для качественного прогнозирования прочности бетона необходимы модели, способные выявлять сложные нелинейные зависимости.

Общие выводы по корреляциям: между большинством признаков слабые линейные связи (корреляции по модулю < 0.4), исключение — water-superplasticizer, flyash-superplasticizer, cement-csMPa, что отражает реальные технологические закономерности бетонных смесей. Другими словами, есть технологически обоснованные связи между компонентами смеси, особенно между superplasticizer и water.

### Возможные причины возникновения выбросов

- **Технологические особенности:** Данные содержат результаты экспериментов с экстремальными составами и возрастами бетона, что отражает реальные производственные и исследовательские задачи.
- **Экспериментальные ошибки:** Некоторые выбросы могут быть связаны с ошибками измерения или записи данных.
- **Физико-химические эффекты:** Экстремальные значения компонентов используются для изучения предельных свойств бетона.

### Практические рекомендации

- Для данного датасета выбросы несут важную информацию об экстремальных режимах и не должны быть автоматически удалены.
- Применение **RobustScaler** оправдано, так как он устойчив к выбросам и позволяет моделям корректно работать с такими данными.
- Линейные модели хуже справляются с задачей, в том числе из-за влияния выбросов, при этом ансамблевые методы (RandomForest, LightGBM) показывают высокую устойчивость и точность.

---

### Использованные модели

- DummyRegressor (базовый уровень)
- PassiveAggressiveRegressor
- ElasticNet
- KNeighborsRegressor
- DecisionTreeRegressor
- RandomForestRegressor
- LightGBMRegressor
- VotingRegressor (ансамбль)

### Ансамбль VotingRegressor (описание использованного ансамбля)
 
В работе использован ансамбль VotingRegressor, объединяющий RandomForest, LightGBM и KNeighbors. 

Ансамбль VotingRegressor — это модель, объединяющая предсказания нескольких базовых регрессоров (в данном случае RandomForest, LightGBM и KNeighbors) путём усреднения их выходов. Реализован как:
 voting_regressor = VotingRegressor(
    [
        ("rf", models["RandomForest"]),
        ("lgbm", models["LightGBM"]),
        ("knn", models["KNeighbors"]),
    ]
)
voting_regressor.fit(X_train_scaled, y_train)
y_pred_voting = voting_regressor.predict(X_test_scaled)

Такой ансамбль позволяет:
- повысить устойчивость к выбросам и шуму,
- снизить риск переобучения,
- получить стабильные и качественные предсказания за счёт объединения сильных сторон разных моделей.

VotingRegressor показал одну из лучших метрик качества (R²), уступая только LightGBM, и может быть рекомендован для задач, где важна стабильность результата.

Для анализа вклада каждой базовой модели в ансамбль VotingRegressor были рассчитаны коэффициенты корреляции между предсказаниями каждой модели и итоговым предсказанием ансамбля на тестовой выборке. В ансамбль включены следующие модели:
- RandomForestRegressor
- LightGBMRegressor
- KNeighborsRegressor

**Корреляция между предсказаниями базовых моделей и ансамбля:**

- **RandomForestRegressor:** высокая корреляция с ансамблем (близка к 1), что говорит о значительном влиянии этой модели на итоговое решение VotingRegressor.
- **LightGBMRegressor:** также показывает высокую корреляцию, часто сравнимую с RandomForest, что указывает на сопоставимый вклад в ансамбль.
- **KNeighborsRegressor:** корреляция с ансамблем ниже, чем у деревьев, что свидетельствует о дополнительном разнообразии, которое эта модель вносит в ансамбль, снижая переобучение и повышая устойчивость.

### Визуализация вкладов

На графике вкладов видно, что предсказания RandomForest и LightGBM тесно согласованы с итоговым ансамблем, а KNeighbors иногда отклоняется, что подтверждает его роль как источника дополнительного разнообразия в ансамбле.

### Выводы

- **Основной вклад в итоговое предсказание VotingRegressor вносят RandomForest и LightGBM**, поскольку их предсказания максимально согласованы с результатом ансамбля.
- **KNeighborsRegressor** вносит меньший индивидуальный вклад, но обеспечивает ансамблю дополнительную устойчивость за счет отличающейся структуры ошибок.
- **Ансамбль VotingRegressor выигрывает за счет объединения сильных сторон разных моделей:** деревья (RandomForest, LightGBM) хорошо улавливают сложные закономерности, а KNeighbors добавляет устойчивость к отдельным аномалиям и выбросам.
- Такой подход позволяет повысить стабильность и точность прогнозирования по сравнению с использованием одной модели, особенно на сложных и шумных данных.


## Анализ сгенерированных признаков и их ранжирования

### Корреляция выбросов с целевой переменной

При анализе корреляции выбросов по каждому признаку с целевой переменной (`csMPa`) были выявлены следующие важные моменты:

- **Наиболее сильную положительную корреляцию с выбросами прочности показывают:**
  - `cement` (0.73)
  - `cement_to_water` (0.71)
  - `binder` (0.57)
  - `age` (0.33)
  - `superplasticizer` (0.22)

- **Сильная отрицательная корреляция:**
  - `slag_to_cement` (-0.49)
  - `slag` (-0.34)
  - `fineaggregate` (-0.24)
  - `flyash` (-0.25)
  - `water` (-0.18)
  - `fine_to_coarse` (-0.18)
  - `total_agg` (-0.17)

**Вывод:**  
Сгенерированные признаки, такие как `cement_to_water` (водоцементное отношение), `slag_to_cement` и `binder`, обладают высокой корреляцией с выбросами по прочности, что подтверждает их информативность и инженерную значимость. Положительная корреляция указывает на то, что экстремальные значения этих признаков часто сопровождаются экстремальными значениями прочности бетона.

---

### Корреляция superplasticizer с другими признаками

- `superplasticizer_to_cement` (0.84), `binder` (0.40), `flyash` (0.38), `csMPa` (0.37), `fine_to_coarse` (0.33), `cement_to_water` (0.33) — все эти признаки положительно коррелируют с superplasticizer.
- Самая сильная отрицательная корреляция у `water` (-0.66), что технологически объяснимо: увеличение суперпластификатора позволяет уменьшить воду.

**Вывод:**  
Сгенерированные соотношения, такие как `superplasticizer_to_cement`, оказываются тесно связаны с исходным признаком superplasticizer, а также с целевой переменной. Это подтверждает, что такие инженерные коэффициенты улавливают важные зависимости в данных.

---

### Ранжирование признаков по важности (RandomForest)

Топ-5 признаков по важности для RandomForestRegressor:

| Признак                  | Важность |
|--------------------------|----------|
| binder                   | 0.34     |
| age                      | 0.34     |
| cement_to_water          | 0.15     |
| water                    | 0.03     |
| cement                   | 0.03     |

- **binder** (суммарное количество вяжущих) и **age** (возраст) — два самых важных признака, что подтверждает их ключевую роль в формировании прочности.
- **cement_to_water** (водоцементное отношение) — также в топе, что полностью согласуется с инженерными представлениями о бетоне.
- Остальные сгенерированные признаки, такие как `slag_to_cement`, `superplasticizer_to_cement`, `fine_to_coarse`, имеют меньший, но не нулевой вклад.

Таким образом, ключевыми оказались инженерные признаки (binder, cement_to_water) и возраст бетона, что подтверждено анализом важности в лучших моделях.
---


### Анализ подобранных гиперпараметров моделей ###
Описание
В ходе работы были проведены подбор и анализ гиперпараметров для ключевых регрессионных моделей: RandomForestRegressor, KNeighborsRegressor, ElasticNet и LightGBM. Подбор осуществлялся с помощью кросс-валидации и методов GridSearchCV/RandomizedSearchCV, что позволило повысить качество предсказаний на тестовой выборке.

**Итоговые параметры моделей:**

 ------------------------------------------------------------------------
| Модель                |	Лучшие гиперпараметры   |	R² (CV) | R² (Test)
| RandomForestRegressor |	max_depth=20,           |          |
|                       | min_samples_split=2,     |          |
|                       | n_estimators=100	      |  0.906	  | 0.894
| KNeighborsRegressor	| n_neighbors=7,           |          |
|                       | weights='distance'	      |  0.768	  | 0.807
| ElasticNet	         | alpha=0.01, l1_ratio=0.1	|  0.595	  | 0.625
| LightGBM	            | num_leaves=31,           |          |
|                       | n_estimators=200,        |          |
|                       | min_data_in_leaf=10,     |          |
|                       | learning_rate=0.1	      |  0.917	  | 0.921
 ---------------------------------------------------------------------                  
Краткий анализ гиперпараметров:
RandomForestRegressor
max_depth=20: Позволяет деревьям быть достаточно глубокими для выявления сложных паттернов, но ограничивает переобучение.

min_samples_split=2: Минимальное ограничение, что делает модель чувствительной к локальным закономерностям.

n_estimators=100: Достаточное количество деревьев для стабильности ансамбля.

Вывод: Модель хорошо справляется с задачей, но чуть уступает LightGBM по качеству на тесте.

KNeighborsRegressor
n_neighbors=7: Оптимальный баланс между локальной и глобальной аппроксимацией.

weights='distance': Ближайшие точки оказывают больший вклад, что снижает влияние шумов.

Вывод: Модель чувствительна к локальным выбросам, но показывает достойный результат среди простых моделей.

ElasticNet
alpha=0.01: Слабая регуляризация, что говорит о необходимости учитывать большинство признаков.

l1_ratio=0.1: Преимущественно L2-регуляризация, что характерно для задач с коррелирующими признаками.

Вывод: Линейная модель ограничена по качеству, но важна для сравнения с более сложными подходами.

LightGBM
num_leaves=31, n_estimators=200: Позволяет выявлять сложные зависимости и обеспечивает высокую гибкость.

min_data_in_leaf=10: Снижает риск переобучения на редких паттернах.

learning_rate=0.1: Оптимальный темп обучения для баланса между скоростью и качеством.

Вывод: Лучшая модель по всем метрикам, особенно эффективна на инженерных признаках.

Влияние подбора гиперпараметров
Автоматизированный подбор позволил каждой модели максимально раскрыть потенциал на конкретных данных.

Ансамблевые методы (LightGBM, RandomForest, VotingRegressor) существенно превосходят по качеству простые и линейные модели.



### Оценка качества

Модели сравнивались по метрикам R², MSE и MAE. 
Краткий обзор результатов

**VotingRegressor (ансамбль)** показал очень хорошие результаты:

R² = 0.903 — высокая доля объяснённой дисперсии.

MSE = 25.123, MAE = 3.511 — хорошие показатели ошибки.

Лучшей по R² оказалась **LightGBM**:

R² = 0.921 (лучше, чем у ансамбля).

MSE = 20.446, MAE = 2.922 — лучшие значения ошибок.

Другие модели (**RandomForest, DecisionTree, KNeighbors**) уступают LightGBM и ансамблю по качеству.

Сравнение моделей
 -------------------------------------------------------
Модель	        |  R²	 |  MSE	|  MAE
LightGBM	        | 0.921|	20.446| 2.922
VotingRegressor  | 0.903|	25.123| 3.511
RandomForest	  | 0.894|	27.424| 3.460
DecisionTree	  | 0.827|	44.576| 4.207
KNeighbors	     | 0.807|	49.778| 5.319
ElasticNet	     | 0.625|	96.614| 7.781
PassiveAggressive|0.479 | 134.127| 9.416
Dummy	           | ~0	| 257.717| 13.052

**LightGBM** — лидер по всем метрикам.

**VotingRegresso**r (ансамбль из нескольких моделей) улучшает результаты по сравнению с большинством базовых моделей, но уступает LightGBM.

**RandomForest** близок к ансамблю, но немного хуже.

Анализ вклада базовых моделей в ансамбль
Корреляция предсказаний ансамбля с LightGBM — очень высокая (0.990), что говорит о доминирующем влиянии LightGBM в ансамбле.

Корреляция с RandomForest (0.335) и KNeighbors (0.220) гораздо ниже.

Это объясняет, почему ансамбль не превосходит LightGBM — ансамбль в основном повторяет предсказания **LightGBM**.

Важность признаков в базовых моделях
RandomForest:

Ведущие признаки: binder, age, cement_to_water (около 0.34, 0.34, 0.15).

Остальные признаки имеют гораздо меньший вклад.

LightGBM:

Ведущие признаки по убыванию важности: age, water, coarseaggregate, cement_to_water, binder.

Значения важности представлены в условных единицах, но показывают схожий набор ключевых признаков с RandomForest.

### Выводы:

**LightGBM** — лучшая модель для текущей задачи.
Если цель — максимальное качество, стоит использовать именно её.

**Ансамбль VotingRegressor** не улучшил результат LightGBM, т.к. LightGBM доминирует в ансамбле.
Визуализация предсказаний LightGBM выполнена.
Ошибки модели (MSE, MAE) достаточно низкие, что говорит о хорошей способности моделей к обобщению.

**LightGBMRegressor** рекомендован как лучший выбор для задачи предсказания прочности бетона на сжатие: он обеспечивает максимальное качество (R² ≈ 0.921) и минимальные ошибки. 

------